---
export interface Props {
    title: string;
    excerpt: string;
    date: string;
    category?: string;
    icon?: string;
    href: string;
    mood?: string;
    image?: string;
}

const {
    title,
    excerpt,
    date,
    category,
    icon = "ðŸ“„",
    href,
    mood,
    image,
} = Astro.props;

// Map mood to color class if needed, or just use inline style
const moodColorMap: Record<string, string> = {
    "coffee-morning": "var(--color-mood-coffee)",
    "bug-headache": "var(--color-mood-bug)",
    "deploy-success": "var(--color-mood-deploy)",
    "deadline-night": "var(--color-mood-night)",
};

// Generate a consistent color based on the category string
const getCategoryColor = (cat: string) => {
    const colors = [
        "#3b82f6", // Blue
        "#10b981", // Emerald
        "#8b5cf6", // Violet
        "#ec4899", // Pink
        "#f97316", // Orange
        "#0ea5e9", // Sky
        "#e11d48", // Rose
        "#14b8a6", // Teal
    ];
    let hash = 0;
    for (let i = 0; i < cat.length; i++) {
        hash = cat.charCodeAt(i) + ((hash << 5) - hash);
    }
    const index = Math.abs(hash) % colors.length;
    return colors[index];
};

const badgeColor = category
    ? getCategoryColor(category)
    : "var(--color-primary)";
const accentColor = badgeColor;
const isExternal = href.startsWith("http");
---

<a
    href={href}
    class="card-link"
    target={isExternal ? "_blank" : undefined}
    rel={isExternal ? "noopener noreferrer" : undefined}
>
    <article class="card">
        {
            image && (
                <div class="card-image-wrapper">
                    {category && (
                        <span
                            class="category-badge"
                            style={`background-color: ${badgeColor}`}
                        >
                            {category}
                        </span>
                    )}
                    <img
                        src={image}
                        alt={title}
                        class="card-image"
                        loading="lazy"
                    />
                </div>
            )
        }
        <div class="card-content">
            <div class="card-meta">
                <span class="card-icon">{icon}</span>
                <span class="card-date">{date}</span>
                {
                    category && !image && (
                        <span
                            class="card-category"
                            style={`color: ${badgeColor}`}
                        >
                            {category}
                        </span>
                    )
                }
            </div>

            <h3 class="card-title">
                {title}
            </h3>

            <p class="card-excerpt">
                {excerpt}
            </p>

            <div class="card-footer">
                <span class="read-more" style={`color: ${badgeColor}`}
                    >Read story &rarr;</span
                >
            </div>
        </div>
    </article>
</a>

<style define:vars={{ accentColor }}>
    .card-link {
        display: block;
        height: 100%;
    }

    .card {
        background: var(--color-bg-subtle); /* Light gray by default */
        border-radius: var(--radius-xl);
        height: 100%;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* Category Badge on Image */
    .category-badge {
        position: absolute;
        top: 16px;
        right: 16px;
        /* background set inline */
        color: white;
        padding: 4px 12px;
        border-radius: 100px;
        font-size: 0.7rem;
        font-weight: 700;
        box-shadow:
            0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -1px rgba(0, 0, 0, 0.06);
        z-index: 2;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card:hover .category-badge {
        transform: translateY(-2px);
        box-shadow:
            0 10px 15px -3px rgba(0, 0, 0, 0.1),
            0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    /* Subtle border on hover */
    .card:hover {
        background: var(--color-bg-card); /* White on hover */
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
        border-color: var(--color-border-hover);
    }

    /* Accent line on top */
    .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--accentColor);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .card:hover::before {
        opacity: 1;
    }

    .card-meta {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin-bottom: var(--space-md);
        font-size: 0.875rem;
        color: var(--color-text-light);
        font-weight: 500;
    }

    .card-icon {
        font-size: 1.25rem;
    }

    .card-title {
        font-size: 1.5rem;
        margin-bottom: var(--space-sm);
        transition: color 0.2s ease;
    }

    .card:hover .card-title {
        color: var(--accentColor);
    }

    .card-excerpt {
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: var(--space-lg);
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-footer {
        margin-top: auto;
    }

    .read-more {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--color-text-main);
        opacity: 0.6;
        transition: all 0.2s ease;
    }

    .card:hover .read-more {
        opacity: 1;
        color: var(--accentColor);
        padding-left: var(--space-xs);
    }

    /* Image Styles */
    .card-image-wrapper {
        width: 100%;
        aspect-ratio: auto; /* Use original image aspect ratio */
        height: auto;
        overflow: hidden;
        position: relative;
    }

    .card-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .card:hover .card-image {
        transform: scale(1.05);
    }

    .card-content {
        padding: var(--space-xl);
        flex: 1;
        display: flex;
        flex-direction: column;
    }
</style>
