---
// Table of Contents Component - Notion style
export interface Props {
    headings?: Array<{
        text: string;
        slug: string;
        level: number;
    }>;
}

const { headings = [] } = Astro.props;
---

{
    headings.length > 0 && (
        <aside class="toc">
            <div class="toc-header">
                <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <line x1="8" y1="6" x2="21" y2="6" />
                    <line x1="8" y1="12" x2="21" y2="12" />
                    <line x1="8" y1="18" x2="21" y2="18" />
                    <line x1="3" y1="6" x2="3.01" y2="6" />
                    <line x1="3" y1="12" x2="3.01" y2="12" />
                    <line x1="3" y1="18" x2="3.01" y2="18" />
                </svg>
                <span>Mục lục</span>
            </div>

            <nav class="toc-links">
                {headings.map((heading) => (
                    <a
                        href={`#${heading.slug}`}
                        class={`toc-link toc-level-${heading.level}`}
                    >
                        {heading.text}
                    </a>
                ))}
            </nav>
        </aside>
    )
}

<style>
    .toc {
        position: sticky;
        top: var(--space-lg);
        background-color: var(--color-bg-secondary);
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        margin-bottom: var(--space-xl);
        border: 1px solid var(--color-border);
        transition: all var(--transition-base);
    }

    .toc:hover {
        border-color: var(--color-accent-blue);
        box-shadow: var(--shadow-sm);
    }

    .toc-header {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        font-size: var(--text-xs);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--color-text-tertiary);
        margin-bottom: var(--space-md);
        padding-bottom: var(--space-sm);
        border-bottom: 1px solid var(--color-divider);
    }

    .toc-links {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }

    .toc-link {
        font-size: var(--text-sm);
        color: var(--color-text-secondary);
        text-decoration: none;
        padding: var(--space-xs) var(--space-sm);
        border-radius: var(--radius-sm);
        transition: all var(--transition-fast);
        position: relative;
    }

    .toc-link:hover {
        color: var(--color-text-primary);
        background-color: var(--color-bg-hover);
    }

    .toc-link.active {
        color: var(--color-accent-blue);
        font-weight: 500;
    }

    .toc-link.active::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 2px;
        height: 16px;
        background-color: var(--color-accent-blue);
        border-radius: 2px;
    }

    /* Indentation for different heading levels */
    .toc-level-1 {
        padding-left: var(--space-sm);
    }

    .toc-level-2 {
        padding-left: var(--space-lg);
        font-size: var(--text-xs);
    }

    .toc-level-3 {
        padding-left: var(--space-xl);
        font-size: var(--text-xs);
        opacity: 0.8;
    }

    @media (max-width: 768px) {
        .toc {
            position: relative;
            top: 0;
        }
    }
</style>

<script>
    // Active link on scroll
    document.addEventListener("DOMContentLoaded", () => {
        const tocLinks = document.querySelectorAll(".toc-link");
        const headings = Array.from(
            document.querySelectorAll("h1[id], h2[id], h3[id]"),
        );

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute("id");
                        tocLinks.forEach((link) => {
                            link.classList.remove("active");
                            if (link.getAttribute("href") === `#${id}`) {
                                link.classList.add("active");
                            }
                        });
                    }
                });
            },
            {
                rootMargin: "-100px 0px -66%",
            },
        );

        headings.forEach((heading) => observer.observe(heading));
    });
</script>
